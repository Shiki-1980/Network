# 1. 概述

## 1.1 发展历程

**协议(protocol)**：计算机（节点）通信时对信息内容、信息表示以及交换过程遵循的共同约定

**体系结构（architecture)**：计算机网络非常复杂，一般被分成多个层次，如何分层以及各层采用的 协议总和称为体系结构

国际电报电话咨询委员会CCITT

**节点(node)**：主机以及交换机和路由器等网络互连设备

## 1.2 交换技术

**交换（Switching）**：网络中多跳(multi-hop)传输时节点如何分配链路资源以将信息 往前转发的方式

 (one-hop) **链路(link)**：通过传输媒体连接相邻的节点

### 1.2.1 电路交换

节点之间的可以传输信息的实际线路称为**物理电路**

在物理电路上按照某种方法（多路复用Multiplexing） 分割而成的多条逻辑的线路称为**逻辑电路**

**多路复用(Multiplexing)**：在物理电路（信道）上按照某种方法分割成 多条逻辑电路(信道），支持多路信号组合起来在一个物理信道上进行传输，无法应对“突发"负载

### 1.2.2 分组交换

**存储转发(Store and forward)**：分组总是从某个输入端口被整个接收下来、检查并选择某个输出端口，排队等着转发到下一跳

分段:在途中允许将分组分割成更小的分组，即进行分段 

重组：分段后的各个分组到达接收者时被 组装在一起，还原成最初发送者发 送的原始分组

**报文交换(message switching)**：特殊的分组交换，发送者发送的报文分组在途中不允许进一步分割，类比邮政快递

## 1.3 性能指标

**数据速率**（Data Rate）：链路上传输数据的速率，一般以bps为单位，即每秒传输的比特数，也可采用Bps 为单位 • B=Byte=8(bits),  b=bit

**带宽**（Bandwidth） 

• 带宽指某个信号具有的频带宽度，即该信号所包含的各种不同频率的范围，单位是赫兹（Hz）。链路允 许通过的信号的频带宽度称为该链路的带宽

**吞吐量**(throughput)：

• 单位时间内通过某个链路（网络等）的实际数据量(bps)，严格的意义应称为吞吐率(throughput  rate) 

• 受到链路的带宽的限制，同时也要考虑到协议的开销以及链路负载的情况

**效率(efficiency)或有效利用率(effective utilization)**：

信道效率有时指归一化的吞吐率，即吞吐率与信道带宽的比率。也可用实际有效的传输数据的时间与所花的总时间的比率表示

**延迟**

1. 处理延迟 $d_{proc}$

2. 排队延迟 $d_{queue}$

3. 传输延迟 $d_{trans}$:

   $d_{trans}=\frac LR$,L为分组长度，R为链路带宽

4. 传播延迟 $d_{prop}$

   $d_{prop}=\frac ds$,d为链路距离，s为信号传播速度(约$2\times 10^8 m/s$)

**往返时间RTT**（Round-Trip Time）： 从发送方发送数据开始，到发送方收到来自接收方的确认（一般假设接收方收到数据后便立即 发送确认），总共经历的时间

**延迟带宽乘积**(BDP, Bandwidth-Delay Product)：链路的传播延迟和带宽的乘积，可以看成以比特为单位的链路长度，表示链路的暂存容量：

![image-20241210153042522]( 笔记.assets\image-20241210153042522-1734439932152-8.png)

 RTT*Bandwidth：发送方的最大发送窗口大小，在收到确认之前可以连续发送的负载大小

## 1.4 电路交换、分组交换和报文交换的比较

- 头部开销：电路< 报文< 分组
- 总延迟：
  - 长时间连续报文：分组交换头部的开销> 报文无法分割带来的管道化的滞后
    - 电路< 报文< 分组
  - 短的突发负载：分组< 报文< 电路
- 对于突发负载而言，链路的有效利用率：电路< 报文< 分组

# 2.网络应用

​	应用层协议一般采取**客户-服务器C/S(Client-Server)**架构

​	IP地址：哪个网络接口（网卡）， 端口号：哪个进程，socket地址。

​	每个节点(主机和路由器)的网络接口(网卡）都有一个IP地址：ID + Locator

**回环地址**：127.0.0.1，对应名字localhost，由IP 模块递交给高层相应的协议(TCP或者UDP)模块，可测试协议栈，可用于主机内不同进程间的通信。

## 2.1 DNS

域名与某种类型（如IP地址）的值之间的映射

主机别名：一个主机可以有多个名字，其中一个称为canonical

**层次名字空间**：

​	采用域名树的方式描述名字空间，方便、易扩展，保证节点下的子节点名字不同。大小写无关

​	采用**分布式方法来维护整个名字空间**，不需要**原子性和强一致性**，允许域名映射有暂时不一致的情况。

![image-20241210154638892]( 笔记.assets\image-20241210154638892-1734439932151-1.png)

​	**域(Domain)**是域名树的一颗完整子树，名字为该子树的根节点的域名。

### 域名服务器

​	至少两个域名服务器管理一个区域，为了负载均衡和提高可靠性

​	**主域名服务器：**维护区域的域名映射

​	**从域名服务器：**从主服务器获得映射的拷贝

​	都是权威服务器，拥有最权威和最新的映射。一个DNS服务器可以充当多个区域的主和从域名服务器

**根域名服务器**：负责管理root区域，将root域下面的所有子树授权给下一级的TLD服务器

### 2.1.1 区域信息

资源记录RR：(name,ttl,class,type,value)

类(Class)：用于Internet时取值为IN

TTL(Time to Live)：该记录在缓存时的有效期(秒)，86400表示1天

DNS响应以RRset(资源记录集）的形式描述，由name/class/type相同，但是value不同的RR组成

![image-20241210155927433]( 笔记.assets\image-20241210155927433-1734439932152-2.png)

![image-20241210155936038]( 笔记.assets\image-20241210155936038-1734439932152-3.png)

![image-20241210155945774]( 笔记.assets\image-20241210155945774-1734439932152-4.png)

### 2.1.2 域名解析

​	主机一般会配置本地域名服务器，也称为**解析服务器**，为用户(主机)提供DNS解析服务

​	递归：发送请求给下一个服务器，对方给出解析结果

​	迭代：发送请求给下一个服务器，对方给出一个可能知道答案的域名服务器

![image-20241210160419337]( 笔记.assets\image-20241210160419337-1734439932152-5.png)

**域名缓存Cache**：

​	![image-20241210160537475]( 笔记.assets\image-20241210160537475-1734439932152-6.png)

注意，DNS响应报告不存在该域名时也可以缓存。

## 2.2 传统应用

### 2.2.1 FTP(File Transfer Protocol)

 **FTP 响应**：

1. 1xx 正常操作，是一系列返回中的一个
2. 2xx 正常操作
3. 3xx 正常操作，服务器等待进一步信息
4. 4xx 暂时错误操作
5. 5xx 永久错误操作

**Active方式**: PORT h1,h2,h3,h4,p1,p2

​	客户方在h1,h2,h3,h4相应的端口上监听

​	服务方发起到port所指的目的地的数据连接

**PASSIVE方式**

​	服务方发送响应：h1,h2,h3,h4,p1,p2

 	主机(一般为服务方)h1,h2,h3,h4在相应端口监听,**由客户方发起数据连接**

### 2.2.2 E-mail

​	格式:user@domain ,domain用于查询DNS，大小写无关

**四个主要部件**：

1. **用户代理(Main User Agent)**:撰写、阅读邮件
2. **邮件服务器(Main Transfer Agent):邮箱**：送达给用户的到来邮件，邮件队列：要发送给其他用户的邮件
3. **SMTP协议**：邮件服务器之间传递邮件
   - **邮件提交协议**：用户代理到邮件服务器，基于SMTP，一般要求用户认证
4. **邮件访问协议**：获得邮件服务器上的邮箱中的邮件，POP3，IMAP，Web Email

#### 1. 邮件格式

RFC 822/2822/**5322**定义了邮件格式

1. 头部：7-bit U.S. ASCII 可打印字符(ASCII码32-126)

   多行文本，每行含type和value，中间以冒号:分隔，注意冒号前不能有空格，有许多邮件头部类型，大小写无关如To: dlmao@fudan.edu.cn” and “Subject: Schedule

2. 邮件体：7-bit U.S. ASCII 字符（ASCII码1-127）

   - 头部和邮件体之间以1个空行分隔 <CRLF><CRLF>  **\r\n\r\n**
   - 邮件内容没有任何其他限制

![image-20241210162731207]( 笔记.assets\image-20241210162731207-1734439932152-7.png)

![image-20241210162800860]( 笔记.assets\image-20241210162800860-1734439932152-9.png)

#### 2.MIME（Multipurpose Internet Mail Extension）

​	仍然采用原有的RFC 822邮件格式，原有的SMTP和访问协议，在撰写邮件时将**非ASCII文本**进行编码后转变为ASCII文本，在邮件阅读时转换回来，支持**多个附件、消息文本整合**在一起，即多个body组合在一起成为一个邮件。

​	引入多个MIME头部:

​	MIME实体(entity):由头部以及消息体组成的一个相对完整的部分，整个邮件是一个MIME Entity，通过MIME头部描述整个消息的组织和编码等信息。在邮件为**multipart**类型时，即多个子消息组成一个大消息时：

- 每个子消息是一个MIME Entity
- 多个MIME Entity组成一个更大的MIME Entity

![image-20241210163432342]( 笔记.assets\image-20241210163432342-1734439932152-10.png)

**(****主要）子类型**

mixed:各个独立的子部分组合在一起，比如附件

alternative:同一内容的不同表示，比如文本和HTML版本

parallel: 各个子部分应该同时使用，比如音频和视频

参数**boundary**给出了各个子部分的边界

分界行：**两个连字符开始**，然后是boundary参数给出的字符串，最后可包含空格（可选）

Boundary参数随机选择，保证MIME Entity中不会出现某行等于分界行，或者某行以分界行的内容开始

multipart类型的body部分的**结束**：**两个连字符开始**，然后是boundary参数给出的字符串，**最后是两个连字符**

#### 3.quoted编码

​	可打印字符从32到126，共95个字符，包括空格、数字、大小写英文字母和标点符号

​	1个字节(octet)可以转换成3个字符："="+两个十六进制(大写)数字，例如：
$$
10011101(9D):  =9D
$$
​	可打印字符不需要转换

#### 4.Base64编码

​	以3个字节为单位进行编码，转换为4个ASCII可打印字符，在以24比特组合时最后可能剩下一个字节或两个字节，在后面填上足够的0，凑够6比特，转换成字符，最后再添加多个等号，剩一个字节添加2个等号，2个字节添加一个等号：
$$
10000001\ \ 00111001\\
100000\ \ 010011\ \ 100100\\
  gtk=
$$

#### 5.SMTP

​	SMTP是一种Push协议，邮件从用户逐步推送经过多个邮件服务器（MTA），直到到达最终用户所在的邮件服务器，每一跳采用SMTP协议可靠递交邮件，基于**7-bit ASCII文本**的请求-响应协议。

![image-20241210185326667]( 笔记.assets\image-20241210185326667-1734439932152-11.png)

Data命令传递的是邮件部分 

- 邮件服务器会在邮件部分最开始插入Received头部, 打上邮戳 
- 途中每个邮件服务器都会添加一个Received头部, 可了解邮件经过的路径以及避免回路

#### 6.邮件访问协议

**POP3**

​	基于文本方式的请求/响应协议，TCP端口110。服务方响应：+OK或 -ERR

1. 认证阶段
2. 事务阶段：dele给该编号对应邮件打上删除标记
3. 更新阶段：删除打过标记的邮件并退出

​	

各个访问协议的区别：

1. POP3：邮件下载到本地，在本地组织管理，也可保留在服务器通过UIDL知道哪些已在本地下载，用户在不同机器上的POP3客户方独自管理下载到本地的邮件
2. IMAP：邮件在服务方存储，允许不同主机对邮件有统一的访问体验
3. Web Mail ：无需邮件客户方，主要一个Web浏览器，发送和阅读都采用HTTP协议

## 2.3 Web和HTTP

​	各个Web Page通过**超链接**(hyperlink)联系在一起，称为超文本(Hypertext) ， 超链接也可以将Web页面与其他图像、音视频、文件等关联起来。

​	Web  Client也称为浏览器，Web Page位于某个Web服务器。

### 2.3.1 HTTP

​	超文本传输协议，无状态的协议，HTTP服务器并**不维护**之前收到的HTTP请求的状态，提供**cookie机制**来传递状态

#### HTTP/1.0:非持续连接

​	TCP连接建立需要1RTT，新建的连接的拥塞窗口为1，即不能发送大量数据，每次HTTP请求都要新建一条TCP连接，然后发送请求，服务方发送HTTP响应并关闭TCP连接：

​	**注意：建立TCP连接后才开始请求传输HTTP资源**

![image-20241210190955627]( 笔记.assets\image-20241210190955627-1734439932152-12.png)

​		如果一个HTML页面里有N个Web对象，且可容纳在一个TCP段里，则需要建立N+1条连接，响应时间为(N+1)*2RTT+传输时间

#### **HTTP/1.1：持续连接**

​	在收到HTTP响应时暂时不关闭TCP连接，等待一段时间，如果有心情求可重用该链接， 如果短时间内有多个到同一个服务器的HTTP请求，可避免连 接建立的开销，拥塞窗口也不用每次从初始的1开始。

**流水线方式**

​	发送第一个请求，收到第一个响应(HTML页面)，发送第2,3,4...个HTTP请求，收到第2、3、4...个HTTP响应，要求**HTTP响应自身能够决定边界**（即结束的位置)。

![image-20241210192418045]( 笔记.assets\image-20241210192418045-1734439932152-13.png)

# 3. 可靠数据传输

​	**TCP假设IP网络可能失序递交，也可能重复**

**差错控制**

​	数据帧再传输过程中可能出错，通过**检验和或差错控制码**检测错误，接收方发送**确认(ACK)**通知发送方帧的接收情况。

**超时机制**:发送方一直没收到ACK，认为数据帧丢失而重传

**顺序号**：数据帧应该包括顺序号，以便区分是否为重传帧，类似地ACK帧也应该包含顺序号，以明确哪个或哪些帧已经正确收到。

## 3.1 停等协议

​	发送者在发送一个帧之后停下来，等待对方确认后继续发送下一帧，如果超时，重传。即发送和接收窗口都为一。

**虚假超时**:ACK迟来导致的超时，可能出现重复的ACK，且这些ACK都到达发送方，因此ACK帧也需要顺序号

![image-20241210193321183]( 笔记.assets\image-20241210193321183-1734439932152-14.png)

​	对于链路层，可假设在链路上的传输可能出错、完全丢失，但是不会出现失序和重复的情况。可以发现顺序号字段只需要1个比特即可。

​	**有一个问题，虚假超时后重传的ACK导致发送者发送一个新的帧，这个新的帧正好丢失**

![image-20241210193817484]( 笔记.assets\image-20241210193817484-1734439932152-15.png)

​	老Frame1和新Frame0丢失，但传输还在继续。

​	`捎带确认`：大部分的通信是双向的，既充当发送方也充当接收方，ACK帧可由反向发送的数据帧一起捎带回来(或者是单独的ACK帧)

### 性能分析

- 信道容量 B bps
- 帧长 L bit
- 往返传播延迟2R秒
- 忽略ACK的开销

则有效传输时间为$\frac LB$:
$$
U =\frac{L/B}{L/B+2R}=\frac{L}{L+2RB} =\frac{1}{1+\frac{2RB}{L}}
$$
​	$\frac {2RB}L$:往返传播延迟

![image-20241210195031935]( 笔记.assets\image-20241210195031935-1734439932152-16.png)

​	最佳帧长度：
$$
Dopt = \sqrt{\frac{H+BT}E}
$$

### 管道化(pipelining)

​	让发送方在等待确认帧回来之前可以持续发送多个数据帧，这要求更大的顺序号空间，并要求能够**缓存哪些已发送但还没确认的帧**，接受者也可以缓存失序到达的帧

​	**发送窗口**，发送方允许发送的数据帧的顺序号范围，在收到ACK后滑动发送窗口

​	停等协议的发送窗口=1

​	假设连续发送$W$帧，则有
$$
U_{pipeline}=\frac{W\cdot L/B}{2R+L/B}
$$
​	要使得信道利用率到100%，则
$$
W_{max}=\frac{L+2R*B}L
$$
​	顺序号bit数至少为：
$$
\lceil log_2\frac{L+2BR}L \rceil
$$
​	考虑到ACK丢失时发送方和接收方不同步的问题，真正的顺序号空间可能还要更大

## 3.2 滑动窗口协议

​	**发送窗口**:发送方在收到新的ACK之前允许发送的数据分组的顺序号范围（**只有序号在窗口内的分组才可以 发送**），也称为outstanding或in-flight

​	**接收窗口**:接收方目前期待接收的数据分组序号（**只有序号在窗口内的分组才可以接收**，否则丢弃）

### 3.2.1 GBN(Go back N)

​	接收者仅允许顺序接收，采用累加确认，超时重传所有未确认分组

#### 发送者

​	如果允许，发送新分组，并更新next_seq,收到ACK时：

如果是**新的ACK**,则更新send_base=ack,如果允许，继续发送分组

如果是其他ACK，丢弃

​	发送者为所有未确认分组维护一个计时器，超时**重传所有未确认分组**

#### 接收者

​	采用**累加确认**，不会单独确认失序到达的分组，ACK n:n之前已经到达的接收者，**期待n**

​	接收窗口=1，只允许顺序接收，维护expected，

- 如果收到的分组顺序号等于expected，更新 expected，发送新的ACK expected
- 如果收到的分组顺序号<expected，发送（重复 的）ACK expected
- 如果收到的分组顺序号>expected，失序到达， 丢弃(也可以发送ACK expected)

### 3.2.2 选择重传

#### 发送者

​	与GBN不同的是，如果ACK seq 在发送窗口内，标记分组已收到;检查是否seq之前的都已收到，如果收到，则滑动到下一个未确认的顺序号。

​	如果收到其他ACK，丢弃

#### 接收者

​	允许**失序接收**，接收窗口>1,接收窗口前沿之前的分组均已确认，接收窗口$\le$发送窗口，一般接受窗口=发送窗口。

​	**单独ACK**：表示已经收到指定顺序号的分组

在收到顺序号为seq分组时：

-  如果seq等于expected，发送ACK seq，滑动接收窗 口前沿expected到下一个尚未收到的顺序号 
-  如果seq在接收窗口内，则缓存，并发送ACK seq 
-  如果seq不在接收窗口内，丢弃，发送ACK seq

# 4. TCP数据传输

​	TCP(Transport Control Protocol)在RFC 793定义，在IP提供的无连接方式的尽力递交的数据传输服务上为应用层提供**面向连接的、端到端(点对点)的全双工的字节流方式的可靠数据传输服务**

## 4.1 TCP段格式

![image-20241212164218878]( 笔记.assets\image-20241212164218878-1734439932152-17.png)

​	
$$
用户数据长度=IP头部的总长度(16Bit)-IP头部长度-TCP头部长度\\
最大值=(2^{16}-1)-20-20 = 65495
$$
TCP段：20字节的固定头部+最多40字节可选头部+用户数据

- **MTU**:**链路层携带的用户数据部分**的最大长度，以太网的MTU =1500字节
- **最大分段大小MSS**：TCP段中的用户数据的最大长度，以太网上的MSS<= 1500-20-20=1460字节
- **源端口号+目的端口号与IP头部的源 IP和目的IP地址以及协议**(TCP or UDP 等)标识一条TCP连接
- 标志位：

  - SYN：同步顺序号，建立TCP连接
  - FIN：无数据发送，连接释放
  - RST：对TCP连接进行复位
  - ACK：确认字段有效标志
  - URG：紧急指针有效标志
- **顺序号**：为每个字节编号，携带的用户数据第一个字节的顺序号，最后一个字节的顺序号=Seq+DataLen-1，SYN=1时表示初始顺序号
- **ACK： 累加确认(32bit)**：ACK=1时有效，是期待接受的下一字节的顺序号，除了最初的SYN段外，后续TCP段的ACK=1
- 接收窗口：收到的数据放在接收缓冲区中，应用程序从接收缓冲区中读取**已按序到达**的数据
- 紧急指针：URG=1时有效。

## 4.2 LFN(Long Fat Networks)

​	$RTT\times BandWidth$：即管道容量远远超过$10^5$比特或12500字节，则称为长飞网络LFN

- **接收窗口(16bit)**：意味着最大为65535字节，WSCALE选项允许接收窗口最大为$(2^{16}-1)2^{14}=1G$字节

- **顺序号(32bit)**：为每个字节编号

  - **顺序号回绕**：一个顺序号使用了，如果接下来传输$2^{32}$个字节的数据，则该顺序号又被再次使用
  - 回绕时，确保前一个顺序号已经不会在网络中了，即要求**顺序号回绕时间>MSL(生命周期)**、
  - 可用时间戳选项解决发送过快带来的顺序号回绕

  ![image-20241212202222010]( 笔记.assets\image-20241212202222010-1734439932152-18.png)

![image-20241212202229350]( 笔记.assets\image-20241212202229350-1734439932152-19.png)

![image-20241212203101271]( 笔记.assets\image-20241212203101271-1734439932152-20.png)

## 4.3 傻瓜窗口症状

​	接收方读取数据较慢，导致尽管有大量数据，但由于发送窗口的限制，只能发送许多小的TCP数据段：

- 接收方应用每次读取少量数据，有更多的缓冲区时(即窗口向后滑动)就马上发送 窗口更新ACK通知发送者
- 发送者发现窗口滑动了，可以继续发送，但只能发送小的TCP段

**解决方案**：

**接收方**

1. 不要发送较小的窗口增长通知
2. 直到可用窗口达到相当大的程度:$min(MSS,RecvBuffer/2)$

**发送方**:

​	延迟发送，直到可发送足够大的TCP段或连接空闲。

# 5.TCP连接管理

​	TCP连接建立是一个**不对称**的过程

## 5.1 TCP连接建立:三次握手		

![image-20241212204015646]( 笔记.assets\image-20241212204015646-1734439932152-21.png)

​	两次握手存在的问题：前一次连接的分组可能会在新的连接期间到达

**三次握手过程**：

![image-20241212204200422]( 笔记.assets\image-20241212204200422-1734439932152-22.png)

1. 互相通知对方要求建立连接
2. 协商选项（MSS/WSCALE/SACK）等
3. 确定数据传输所需要的参数，最为关键的是**同步初始顺序号ISN**

两台主机想在相同的socket间建立一条TCP连接而发生冲突，也可以正常工作：

![image-20241212204403478]( 笔记.assets\image-20241212204403478-1734439932152-23.png)

## 5.2 初始顺序号

​	TCP连接记录最近一段时间的老连接的顺序号信息：

- 建立好的连接最后释放时，主动关闭的一方将进入TIME-WAIT状态，等待2\* MSL时间后才真正关闭
  - 记录老连接使用的最大顺序号
  - SYN请求只有在其**初始顺序号超过老连接的最后顺序号时**才会接收

# 6.TCP拥塞控制

## 6.1 瓶颈链路

​	Client和server之间的最大带宽为所有链路带宽的最小值

![image-20241214142648575]( 笔记.assets\image-20241214142648575-1734439932152-24.png)

​		N各clinet和N个server之间建立10条连接，这些连接共享backbone瓶颈链路R bps，假设他们公平共享瓶颈链路：

![image-20241214142828759]( 笔记.assets\image-20241214142828759-1734439932152-25.png)

​	则每条连接的平均吞吐率最大为$min(R_c,R_s,\frac RN)$

## 6.2 拥塞控制与流量控制

​	拥塞： 在某个时刻多个发送者发送的数据太多以致网络的某个部分的容量无法容纳这么多的分组

​	拥塞导致分组丢失和长延迟

​	传统的路由器采用FIFO和Drop-Tail

- 流量控制：防止发送过快以至于另一方缓冲区用完的情况
  - 接收窗口rwnd：接收方在ACK中给出其空闲的缓冲区大小
  - 接收窗口限制了发送方的发送速度
- 拥塞控制：
  - 拥塞窗口cwnd：估计的网络容量的大小
  - 拥塞窗口限制了发送方的发送速度

TCP的发送受到流量控制和拥塞控制的制约：
$$
LastByteSent – LastByteAcked <= min(cwnd, rwnd)
$$
​	TCP**假设分组丢失的主要原因**是由于**网络拥塞(缓冲区满)而丢弃**分组，而不是由于链路上的差错导致的分组丢失。

​	**拥塞事件**：

- 超时：严重拥塞出现，发送者需要大幅降低发送速度
- 3个重复ACK，说明有分组丢失但也有3个分组到达接收者，**轻微拥塞或者已从拥塞恢复**

拥塞控制可分为两个部分：

- 在连接刚建立或者出现严重拥塞时，探测网络的可用容量cwnd(慢启动)

- 在连接持续期间，动态调整cwnd以适应网络容量变化：
  $$
  rate =\frac {cwnd}{RTT} Bytes/sec
  $$

### 6.2.1 慢启动 Slow Start

​	初始拥塞窗口cwnd = 初始窗口IW(最初的规范为1个MSS)，连接建立阶段的ACK不改变拥塞窗口，建立后，每收到一个**新的ACK**，拥塞窗口增加1一个MSS。每个RTT后，拥塞窗口翻倍。

### 6.2.2 动态调整拥塞窗口

​	cwnd 过大，变为原来的1/2，随后缓慢增加拥塞窗口，每个RTT增加1MSS：

![image-20241214144442647](笔记.assets\image-20241214144442647-1734439932152-26.png)

​		拥塞窗口在网络容量附近抖动，注意：TCP连接的容量时动态变化的，一条连接关闭，可用容量增加，另外一条连接建立，可用容量减少。

​	实际情形中，当发送者通过**发送方超时**检测出现严重拥塞时，已经**滞后**了，网络容量也可能动态变化，此时**管道可能已为空**，没有ACK来驱动新的分组发送，需要重传分组，并且**重新探测网络的容量**

​	发送者重新开始慢启动：cw=丢失窗口(一般为1个MSS)

​	发送者可以估计在超时时刻网络容量为拥塞窗口的一半：

- 在接近该容量时拥塞窗口增加的速度减慢
- 引入**慢启动阈值ssthresh=超时拥塞窗口的一半**：
  - 如果拥塞窗口小于ssthresh，则为慢启动阶段，拥塞窗口指数增加
  - 如果大于ssthresh，为拥塞避免阶段，拥塞窗口线性增加
  - 如果等于ssthresh，则任意，**一般采用拥塞避免**

**超时和重开空闲连接**：

1. 超时

​	如果RTO计时器超时，意味着**严重阻塞**，调整慢启动阈值ssthresh为当前拥塞窗口的一半：
$$
ssthresh\leftarrow cwnd/2
$$
​	cwnd设置为丢失窗口，LW为1个MSS：
$$
cwnd \leftarrow 1\ MSS
$$
​	进入慢启动阶段。

2. 连接空闲较长时间：

   这种请况TCP无法利用ACK来探测网络的容量，仍然按原有的拥塞窗口大小发送数据，可能会造成网络的拥塞，则如果TCP空闲超过一段时间(即**重传超时的时间**)，在重新开始传输数据时
   $$
   ssthresh \leftarrow cwnd/2\\
   cwnd \leftarrow 1\ MSS\\
   进入慢启动
   $$

### 6.2.3 总结1

**慢启动+拥塞避免**

![image-20241214150156679]( 笔记.assets\image-20241214150156679-1734439932153-27.png)

# 7.网络互连

​	TCP在网络层提供的节点间的数据传输服务基础上实现可靠的数据传输。

​	在链路层提供的服务基础上通过**多跳传输**将数据递交到最终目的地。

- 路由器
  - 数据平面：从接口收到一个IP分组后查找转发表，转发到下一跳
  - 控制平面：为数据平面提供支持，维护转发表等

​	互联网内部可能有两种工作方式：**虚电路**和**数据报方式**。区别在于节点收到一个分组进行转发时所遵循的路由**何时决定**

- 数据报方式：无连接方式

  无需建立连接，在**数据传输时决定路由**

- 虚电报方式：面向连接的方式

  分为连接建立、数据传输和连接释放三个阶段。仅仅在**连接建立时进行一次路由选择**，以后在该连接上的所有分组沿着预先建立的路径传输。

  和**电路交换**的区别：仍然采用**分组交换(存储转发)**方式，收到分组后在往下一个节点方向的端口处排队，等待链路空闲后发送

  **电路交换**:通过路由选择建立了一条电路，同时为其分配了**独占使用的带宽资源**.

## 7.1 互联网的工作方式

### 7.1.1 虚电路

​	一条虚电路途中经过多个中间节点，每个节点需要维护虚电路上的上一节点和下一节点信息。考虑到每个链路上可能会有多条虚电路通过，要能够区分收到的分组属于哪个虚电路，要转发给哪一个下一跳节点。

​	则分组中应包含虚电路号，全局虚电路要求虚电路号全局唯一，节点间需要交换信息以知道哪些虚电路号可用，动态虚电路在各个链路上可动态变化，只要求在链路唯一。

​	**永久虚电路PVC**：管理员静态配置

​	**交换虚电路SVC：**节点根据连接建立请求携带的源和目的地址等信息，决定下一跳节点，并决定链路上区分虚电路的虚电路号，实践中，一般由下一跳节点选择一个在该链路上唯一的虚电路号。

​	每个节点需要维护**路由信息**，即前一个节点和后一个节点的标识，以及**虚电路号**，前一个链路和后一个链路上唯一的虚电路号。

​	如果允许双向数据传播，则节点i为链路ij选择虚电路需要考虑：

1. 本节点i在对应的**外出链路ij**上用过的虚电路号
2. **到来链路ji**上邻居节点j选择的虚电路号，可以从之前收到的信令信息中了解到。

![image-20241217123003113](笔记.assets/image-20241217123003113.png)

![image-20241217123012757](笔记.assets/image-20241217123012757.png)

**数据包和虚电路**：
![image-20241217123041792](笔记.assets/image-20241217123041792.png)

### 7.1.2 逐跳路由

​	根据**选择路由的方式**可以分为逐跳路由和源路由。

**逐跳路由：**每个节点仅知道路径上的下一跳节点，可能短暂出现**路由回路**。

**单播路由：**单个目的节点

**多播路由**：一个或多个源发送分组给**多个目的节点**，多个节点共同维护一颗组播树。

#### 路由方式

1. 严格源路由：发送方给出路径上**每个节点**列表，要求严格按照列表进行转发，途中**不允许经过其他节点**，即要求节点列表上的相邻节点也是路径上的相邻节点
2. 松散源路由：给出路径上**需要途径的节点**列表，**允许通过不在列表中的节点**

可结合在一起，通过位图(bit map)来说明哪一段为严格或松散源路由

## 7.2 Internet网络层

​	**网络层提供的服务：为高层提供节点到节点的传输，经过多跳传输最终到达目的地**

**Internet设计原则**：

1. 连接各种类型的异构网络

   **沙漏模型，IP时核心**，要求下层物理网络提供基本数据递交功能

   **无连接方式，IP提供尽力递交(best-effort)的数据传输服务**:无带宽保证，分组可能丢失、失序、延迟，无拥塞指示。

2. 路由器和链路故障仍能通信

   命运共享策略：只要网络连通，端系统间的通信仍然可继续

   - 无状态的路由设计：路由器不需要为端系统间的**分组流**维护状态信息
   - 软状态机制：路由表的维护通过**定期地刷新**(路由信息交换)来完成，**超时**状态被移走
   - 端到端地设计原则，

3. 有效利用网络资源，支持各种类型的应用

   端系统提供面向连接的可靠、按序递交的**TCP服务**和无连接方式的不可靠**UDP服务**

### 7.2.1 IP协议

​	RFC 791 定义了IP协议，IP协议分组格式的设计考虑到：

1. 无连接方式，提供转发支持：**源地址和目的地址**
2. 多个高层协议：**协议**(ICMP 0x01 、TCP 0x06、UDP 0x11)
3. 路由回路：**生命期TTL(Time to Live)**字段，每经过一个节点**转发时**，**TTL减1**，为0时丢弃，目的地收到TTL=0的分组不会丢弃
4. 分组出错：**头部检验和**字段，每跳都要重新计算
5. MTU限制：**分段和重组**

#### IP分组格式

![image-20241217124859116](笔记.assets/image-20241217124859116.png)

#### 分段和重组

​	IP采用**接收方重组**的策略，接收方要求能够处理长度至少为576字节的分段。通过IP源地址和目的地址+**分段标识(16bit)**标识原始分组，不是所有的分组都可以分段。

​	每个分段包含**分段偏移(13bit)**:分段携带的数据在原始IP分组中携带的数据部分所处未知的偏移量，单位为**8个字节**

​	**前面的分段携带数据必须为8的倍数！**

​	接收端通过如下标识判断分段均已到来：

- **MF**,标识后面是否还有分段，收到MF=0的分段，且之前所有的分段均已到来确认，可以重组。如果重组计时器超市，丢弃所有的分段
- **DF**:不允许分段，如果必须分段，则丢弃该分组，并发送**ICMP**差错报告给发送者

![image-20241217125936064](笔记.assets/image-20241217125936064.png)

### 7.2.2 MAC地址

​	局域网中有多个节点，节点通过网卡连接到局域网，每个网卡有一个在**该局域网上唯一**的MAC地址。MAC地址用于标识某个网卡，并不需要描述是哪个局域网上的网卡，采用**平坦地址空间**

​	MAC地址为6个字节(48bit)，也称为EUI-48地址,前24个比特分配给某个厂商或机构。每个字节用16进制标识，之间用连字符或冒号隔开，例如：
$$
AC:DE:48:12:78:80\\
AC-DE-48-12-78-90
$$
​	**IEEE 802 标准在描述多字节整数采用最高字节在前的顺序，每个字节采用最低位在前(LSB)的顺序**，第一个字节的最低两位(LSB)有特殊含义：

1. 最低位为I/G：为0表示单播地址，为1表示组播地址
2. 次低位位U/L：位0时位全局地址，位1时是本地管理地址

例如：

![image-20241217130613401](笔记.assets/image-20241217130613401.png)

​	不是组播地址！



### 7.2.3 IP地址

​	每个节点都有一个IP地址：**ID+locator**

​	IPv4协议使用的IP地址位32比特的整数，采用**点十进制方法描述**,每个字节转换为十进制数字，中间以.隔开：

![image-20241217130800825](笔记.assets/image-20241217130800825.png)

#### IP地址类

​	三类：A类、B类、C类，主机部分分别为3、2、1个字节

1. A类：1/2地址空间，网络号全0和127有特殊含义，则有126个网络，支持$2^{24}-2$台主机
2. B类：1/4地址空间，$2^{14}$个网络，$2^{16}-2=65534$个主机
3. C类：1/8地址空间，$2^{21}$个网络，254($2^8-2$)台主机

![image-20241217131107825](笔记.assets/image-20241217131107825.png)

#### 特殊IP地址

​	全0表示this，全1表示all

- 主机部分，全0可表示本网络，比如202.120.224.9，全1可作为目的地址，表示网络中的所有主机，定向广播地址。
- 网络部分和主机部分，全1可作为目的地址，本地广播地址，表示接口上的所有IP主机。全0：
- 网络部分：全0：可作为源地址，表示尚未知道网络部分的地址，很少使用
- A类地址127.0.0.0，第一个字节为0111 1111 表示loopback地址

**回环地址**

​	**127.0.0.1**为回环地址(实际上为127.x.x.x)，对应名字loaclhost。任何发送到该地址的IP分组不会发送到实际的网卡上，而是由IP模块递交给高层相应的协议(TCP或者UDP)模块，可测试协议栈，可用于主机内不同进程间的通信，IP模块从高层收到目的地为**本机某个接口的IP地址**时通过回环接口递交给高层协议模块。

#### 子网地址

​	A类/B类/C类网络内部进一步划分子网，三层层次结构：网络ID+子网ID+主机ID

​	引入子网掩码，32bit的整数，使用点十进制方法描述，如果为主机部分，则对应的比特为0，否则为1，按**位与**来截取网络部分。一般之际部分位最后的一些比特，用/n表示前面n个比特(前缀)位网络部分：

![image-20241217132138083](笔记.assets/image-20241217132138083.png)

​	变长子网掩码VLSM，不同子网采用不同的子网掩码，例如202.120.224.0/24要分配给5个子网，其中3个子网要支持50台，另外2个子网支持30台主机：

![image-20241217132252526](笔记.assets/image-20241217132252526.png)

#### CIDR

​	抛弃IP地址类的边界，通过**地址汇集**的方法描述连续地址块(某个网络)。

​	用于描述网络部分的**网络掩码可以是任意长度**，从0到32

​	/32只有一个地址，表示主机

​	/31的掩码只有2个地址，常用于路由器之间的点到点链路上，**主机部分的0和1**不被解释位网络或广播地址

​	长度位0的掩码相当于任意IP地址，表示缺省路由

**子网和超网**

​	决定网络部分和主机部分的分界线从原来的IP地址类确定的界限往右移动，称为**子网**，往左边移动称为**超网**

**实例**

​	ISP拥有16个C类地址，192.60.128.0/20，假设某个用户需要1000个左右的IP地址，可以分配4个连续的C类地址，这4个C类地址被汇集称为：192.60.128.0/22

![image-20241217132959662](笔记.assets/image-20241217132959662.png)

### 7.2.4 IP转发

​	接收分组，并查找转发表将分组转发给相应的外出接口。**转发表根据路由表来确定**

​	转发表一般包含:**目的网络/网络掩码**/下一跳/网络接口。

- 网络掩码为255.255.255.255(/32)的路由位**主机路由**
- 网络掩码为0.0.0.0(/0)的路由为**缺省路由**，当转发表中找不到路由时采用
- **直接路由**:目的节点和当前主机在同一网络，可直接通过对应的接口递交
- **间接路由**：需要通过下一跳路由器转发

​	转发过程不改变源和目的IP地址，改变的时MAC地址：

![image-20241217133440788](笔记.assets/image-20241217133440788.png)

​	转发表中可能会有多个表项匹配，需要采取最长前缀匹配原则：网络掩码最长的匹配

### 7.2.5  地址解析协议ARP

​	该协议用于以太网等广播网络中，**将IP地址映射为MAC地址,RFC 826**

​	如果不知道IP地址对应的MAC地址，发送ARP请求，暂时保留IP分组在缓冲区。APR请求使用链路层广播发送：

​	Sender MAC address、Sender IP；`Target MAC address=?` (全0或全1，或者其他值)、Target IP

​	Target IP节点单播发送响应给发送者，源和目的字段对调，并填写源MAC地址：

​	`Sender MAC address`、Sender IP、Target MAC address、Target IP

​	IP地址和MAC地址映射保存在**ARP缓存**中，一定事件后移走。

![image-20241217134749084](笔记.assets/image-20241217134749084.png)

### 7.2.6 DHCP

​	动态主机配置协议DHCP（Dynamic Host Configuration Protocol）

- RARP(协议)：网卡地址$\rightarrow$IP地址，采用**以太网广播 **，无法跨越IP子网，仅能返回IP地址。
- BOOTP协议：为无盘工作站引导提供支持(IP地址+映像所在服务器+文件名)，采用**UDP协议**,允许跨越IP子网，除了**分配IP地址**外，还可传递**引导所必须的信息**:操作系统映像所在的主机和位置。

DHCP在**BOOTP基础上扩展**而来，采用C/S架构，采用UDP

- DHCP服务方端口号为67，客户方端口号为68
- DHCP服务器可提供**IP地址**,掩码，缺省路由器，DNS服务器，缺省TTL等参数配置
- 3种IP分配方法
  - 自动方法：根据唯一客户标识(比如网卡地址)**固定分配(租期无限，lease time =0xFFFF FFFF)**
  - **动态方法：从地址池种租用一个**
  - 手工方法：IP地址通过第三方方式分配，DHCP用于配置其他参数

### 7.2.7 NAT

​	内部网络中的主机一般不会要求在同一时刻全部连接到Internet，于是使用网络地址转换NAT，有多种形式。

#### 基本NAT

​	负责在内部网络用到的**内部IP地址**与外部用于连接到Internet的**公共IP地址**之间进行地址转换。

- 从内到外：转换**源地址**
- 从外到内：转换**目的地址**

![image-20241217135317807](笔记.assets/image-20241217135317807.png)

#### 基于端口的NAT(NAPT)

​	实现(IP地址+16bit的端口号)的转换。针对主机的每个会话进行映射，内部主机的应用(内网主机+端口)被映射为某个外部IP地址+端口号。

​	一个公共IP地址可以由65535个端口号，可对应内网中的6万多个socket(应用)

- 从内到外：转换**源地址+端口号**
- 从外到内：转换**目的地址+端口号**

![image-20241217135550685](笔记.assets/image-20241217135550685.png)	

NAT和NAPT仅根据IP分组头部和TCP段头部进行地址转换，某些应用层协议的消息中也包含了地址和端口号信息，需要配套的应用层网关进行相应的NAT转换：

#### 其他NAT形式

例如DNS协议中，含有DNS相应中的IP地址(A RR等)，采用**双向NAT**

​	双向NAT，内网中的主机可访问外网，通过DNS ALG也允许外网中的主机通过名字访问内网中的服务器，DNS响应给出的时服务器的内部地址，通过NAT时更新NAT映射表，对DNS响应中的IP地址进行地址转换。

**两次NAT (Twice NAT)**

​	内部网络(inside local)和外部网络(outside global)的IP地址空间有**重叠**时，这些具有重复IP地址的主机之间的分组的源地址和目的地址可能都需要进行转换

需要同时转换源IP地址+端口号以及目的IP地址和端口号

199.11.4.2:9120 --> 192.168.4.1:8080 通过NAT之后映射为 198.51.100.1:3000 --> 199.11.4.1:80

![image-20241217140230709](笔记.assets/image-20241217140230709.png)

### 7.2.8 IP隧道

​	采用IP协议的网络上的任意两个节点之间建立的一条**虚拟链路**（虚拟接口 tun)

​	.....

### 7.2.9 IP组播

​	**组播:一对多或多对多**

**应用层组播**

​	不是由源直接单播给所有接收者，引入一个或多个中继节点，由源单播发送给中继节点，每个中继节点再单播发送给其他接收者。

![image-20241217140557711](笔记.assets/image-20241217140557711.png)

 **IP组播**	

​	由**网络层提供组播支持**，允许一个或多个发送者发送单一的IP分组到特定的多个接收者，组播路由器保证每个链路上最多只会由分组的一份拷贝。

![image-20241217140700038](笔记.assets/image-20241217140700038.png)

#### 任意源组播ASM

​	**发送者没有限制**，可以不属于组播组，组装一个组播帧(目的地址为组播地址)发送就可以了，接收者属于同一个组播组，通过**组播地址标识**。

​	组播组可任意规模，接收者可在Internet上**任何地方，动态加入或退出**

​	组播路由器负责将组播分组转发给所有成员所在的网络上，保证在任意一个网络上最多传输一次，者要求组播路由器知道其所连接的接口方向是否有成员存在，这样只需要往有成员存在的方向转发就可以了。

​	组播路由器间维护一个**组播分发树**，组播分组沿着该分组发送。

![image-20241217141039384](笔记.assets/image-20241217141039384.png)

#### IP组播地址

​	![image-20241217141105800](笔记.assets/image-20241217141105800.png)

​	成员可位于Internet的任何地方，故组播地址采用**平坦地址**结构

`D类地址(组播地址)`：224.0.0.0~239.255.255.255

**永久组播地址**：路由和拓扑发现

- 由IANA分配，范围为224.0.0.0至224.0.0.255

- **本地唯一（Link-Local），TTL取值为1，不被转发到其他链路**

**临时组播地址**：

需要保证在一定的范围内没有其它的组播组使用同一地址： **如何为应用分配组播地址？**

**本地管理(内部）组播地址，地址范围为239.0.0.0～239.255.255.255**

- 类似于单播IP地址空间的内部地址，只在内部网络中使用
- 内部网络的出口路由器保证该组播分组不会被传播到Internet之上

![image-20241217141347104](笔记.assets/image-20241217141347104.png)

#### 单一源组播SSM

​	只有一个发送者，一个组播会话通过$<source,group>$标识，避免了原ASM模型中组播地址分配的问题，组播路由器将通过组播路由协议维护**基于源的组播分发树**，更加简单和高效。

![image-20241217142421500](笔记.assets/image-20241217142421500.png)

#### 组成员关系协议IGMPv2

​	IGMP协议工作在主机-路由器上，建立在IP上，协议号为2，组播路由器通过IGMP协议了解其所连接的那些链路上**是否有成员属于组播组**

​	每个组播路由器定期(**60到90秒，RFC标准为125秒**)，发送Query给**所有主机(224.0.0.1)**,主机收到Query后**发送Report到所属的组播地址G**。

​	反馈抑制：Query包含最大响应时间(**缺省10秒**)，主机选择$[0,Max\ Resp.Time]$时刻准备发送Report

​	主机在加入时主动发送Report(**间隔10s，发送2或3个Report**)

​	软状态机制：定期发送Query更新状态，超时时移走状态信息

**离开**

​	最后一次Query发送report的主机发送Leave Group消息给**所有(组播)路由器(224.0.0.2)**，随后组播路由器发送指定了组播组的Query，询问对于**特定的组播组G**是否还有成员在。

![image-20241217142337120](笔记.assets/image-20241217142337120.png)

​	RFC 3376 给出了IGMPv3规范，支持**单一源组播SSM**

### 7.2.10 IPv6

​	IPv4匮乏，发明了IPv6

​	128bit

![image-20241217142549216](笔记.assets/image-20241217142549216.png)

#### IPv6地址

​	以16bit为一组，分为8组，每组以十六进制书写，组与组之间用冒号分割。IPv6地址书写格式中的0可以压缩，每组中前面的0可以移走，连续的为全0的组可省略，但仅缩写一次(即两个冒号)：

![image-20241217142807206](笔记.assets/image-20241217142807206.png)

​	IPv4地址可在最低的32bit出现。

​	IPv6没有广播地址，组播地址为：FF00::/8 ,前面8bit全为1

​	IPv6接口会配置一个链路唯一的IPv6地址(FE80::/10)，与链路上的其他IPv6主机通信，IPv6接口还可配置一个全局单播地址：
![image-20241217143558235](笔记.assets/image-20241217143558235.png)

#### 配置IPv6地址

**链路唯一的IPv6地址**(FE80::/10)，即：

​	**1111 1110 10 +54个0** + `64bit的接口地址`，可与主机链路上的主机通信

**全局唯一的IPv6地址**

​	可采用**DHCPv6**获得IPv6地址以及其他配置信息

![image-20241217143814811](笔记.assets/image-20241217143814811.png)

**64bit接口地址**

​	基于MAC地址得到，拆成前后两部分，中间加上FF：FE，并将第七位(U/L比特取反)即可，例如：
$$
00-d0-59 - 59-38-80\\
00d0:59ff:fe59:3880 \\(前八位为0000\ 0000 ),则\\
02d0:59ff:fe59:3880
$$
​	也可进行跟踪，有安全隐患。

# 8.路由协议

​	建议直接看PPT，比书上清晰一些

# 9.物理层

​	两个相邻节点通过**传输媒体**传递信息

​	**传输媒体(介质)**:相邻节点间实际传送信息的物理载体。传输媒体具有不同的带宽和抗干扰能力，限制了最大数据速率。**带宽**指的时其上面允许通过的信号的**频率范围的宽度**

## 9.1 传输媒体

​	**物理信道**常指从变换器输出到反变换器输入之间的部分，除了实际载体外，还包括**天线**、滤波器以及功率**放大器或者转发器**等附加通信设备，**广义的传输媒体**

**单工(simplex)通信：**系统只有一端可以发送，另一端只能接收。 

**双工(duplex)通信：**信道的两端都可以发送和接收 

- **全双工(full duplex)通信**：任何时刻在两个方向上可以同时进行通信 
- **半双工(half duplex) 通信**：在两个方向上都可以进行通信，但在任何给定时刻只能在一个方向 上进行通信

基于传输媒体上信号的传播方向性，可分为：

**导向(guided)媒体**：实际的物理线缆限制了信号传播的路径，包括双绞线、同轴电缆、光纤、 电力线等 

**非导向(unguided)媒体：**信号通过空气、水等无形的载体进行传播，包括无线电通信、微波通 信、红外通信、激光通信、卫星通信、水声通信

![image-20241217151136325](笔记.assets/image-20241217151136325.png)

​	后面一堆传输媒体的介绍(例如双绞线，光纤，之类的，先跳过。

### 9.1.1 无线媒体

​	**衰减**指信号的强度随着其传输的距离增加而降低的现象

​	**自由空间传播模型**:距离越长，损耗越大，频率越高，损耗越大，即与**频率f(波长$\lambda$)和距离d**有关：
$$
\frac{发送功率}{接收功率}=(\frac{4\pi d}{\lambda})^2
$$
​	低、中频波段，波长长，可轻易越过障碍，**地波传播**

​	高频、甚高频(短波，超短波),沿地表传播会被吸收，但可通过电离层反射，达到更远的距离，**天波传播**，受天气和昼夜影响，不是很稳定。

​	超高频(微波)，地波传播衰减大，天波传播吹穿越电离层，一般采用**空间波(视线)传播**:

- 卫星微波：通过卫星中转
- 地面微波：采用较高的微波定向天线中转

#### 天线

​	无限媒体的发送和接收时通过天线实现的，分为全向天线和定向天线(**频率较高**)，天线的直径要求至少为无线信号的波长的**1/10**。

​	对于无线媒体而言，频率越高，支持的数据速率越高，传播的距离越小（衰减越大），绕过障碍物的能力越差，定向性更强

#### 通信

- **无线电通信**：使用3kHz到1GHz的频段，**受到无限电管制**,采用地波和天波传播，一般采用**全向传播**，适合**组播或者广播方式的应用**
- **微波通信**：1GHz~300GHz，也受到无线电管制，**ISM波段无需申请许可证，如2.4GHz和5GHz等**,地面微波采用**定向天线**支持视线传播
- **卫星通信**，利用**地球同步轨道**卫星为中继转发微波信号，无距离限制，但传播延时较长。
- 水声通信，采用**声波**在水中传播，声波传播速度大约只有1500m/s，延迟比较大

## 9.2 信道的最大数据速率

​	信道允许一定频率范围的信号通过(带宽)，数字信号的带宽时无限的，具有有限持续时间T的**数字信号**可看作以$T=\frac 1f$为周期的函数，由无限个正弦和余弦的多次**谐波（频率为nf）**组成。

​	信道带宽越小，通过谐波次数越少，信号越容易失真。

​	假设信道带宽为H Hz，调制时以S（=8）比特数据为一个信号单元（符号，Symbol），数据速率为 C bps，基波频率f = 1/T = C/S，则允许通过谐波次数为：
$$
n = \frac Hf = \frac{H\cdot S}{C}=\frac{8H}{C}
$$

### 9.2.1 Nyquist和Shannon定理

​	奈奎斯特采样定理给出了**有限带宽H**的无噪声信道的最大数据速率。

**采样定理**：只需以每秒2H次的频率采样就能够完整地重构原有地波形。

**波特率**(码元速率/调制速率)和数据速率：

- 波特率B：每秒信号状态变化的次数，以波特为单位，则B=2H
- 数据速率：每秒传输的比特数

$L$为信号可取的离散值的个数，实际信道中存在噪声，故离散值不能太多，则可得出最大速率为：
$$
C=2H\log_2L
$$
​	香农定理给出了受噪声干扰的信道最大数据速率。

**信噪比SNR：**用分贝dB为单位来表示：$10\lg\frac SN (dB)$

假设分贝值为$x (dB)$，则信噪比$=10^{\frac {x}{10}}$，则最大速率为：
$$
C=H\log_2(1+S/N)
$$
​	信道的最大速率受二者约束，取最小值。

## 9.3 数字编码

​	即从数字数据编码成数字信号，数字数据以数字信号方式在信道上传播。

**NRZ(Non-Return-Zero)编码**

​	一种信号状态(正电压)代表1，另一种信号状态(负电压)代表0，没有中间状态

**NRZI(NRZ Inverted on ones)** ：差分编码

​	比较相邻的信号单元，**用信号的跳变表示1**，无跳变表示0，解决了连续1的问题，但还是没解决连续0的问题

**曼彻斯特编码**

​	每个比特的传输都有电压的跳变，一个比特时间T分为两半:

- 高$\rightarrow$低为1
- 低$\rightarrow$高为0

​	编码效率只有50%

**差分曼彻斯特编码**

​	**比特时间的开始处**的跳变有无来表示0或者1，**有跳变表示0**，没有跳变表示1。每个比特时间仍然有一个跳变，用来同步。

<img src="笔记.assets/image-20241217155714987.png" alt="image-20241217155714987" style="zoom: 50%;" />

**4B5B编码**

​	4bit的数据用5bit的码组来编码：

- 保证码组前面没有多于1个“0”，尾部没有多于2个“0” 
-  采用4B5B编码的码组流不会出现超过连续3个“0”

5比特的码组再用NRZI编码（有跳变表示1） ，每个5比特的码组至少有2个“1”，也就是有2次跳变

​	效率是80%

## 9.4 数字调制

​	调相、调频和调幅：

![image-20241217160220110](笔记.assets/image-20241217160220110.png)

![image-20241217160313452](笔记.assets/image-20241217160313452.png)